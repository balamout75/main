import java.rmi.RemoteException;



import java.awt.event.*;
import javax.swing.*;
import javax.swing.tree.*;
import java.awt.*;


/**
 *
 * @author  Иван
 */
//public class QuestionEditorPanel extends javax.swing.JPanel implements DNDCompInterface{
public class ConstrainsDataModule extends javax.swing.JPanel {


    static int alter     = 1;
    static int nonalter  = 2;
    static int free      = 3;

    private INIACRMIInterface   Server;
    private AnswerMark AM;

    Integer DictionaryIndex;

    private Library Lib;
    private RInterface  RQI;
    private QuestionInterface   QI;
    private DictionaryInterface DI;
    private boolean JTreeFocus;
    private AnswerCheckBoxNodeEditor TCE;
    private DataModuleInterface DMI;
    private javax.swing.JTree jTree1 = new javax.swing.JTree();



    public class InternalFrameEventDemo implements FocusListener {

        public void focusGained(FocusEvent e) {
            //if
            //Lib.setTypeOfToolbar(3);
            //System.out.println("Internal frame GainedFocus");
        }

        public void focusLost(FocusEvent e) {
            //System.out.println("Internal frame LostFocus");
        }

    }

    public ConstrainsDataModule (Library aLib) {
        try  {
            initComponents();
            Lib = aLib;
            Server = Lib.Server;
        } catch( Exception e )	{
            System.out.println( e.toString() );
        }
    }

    public void setDMI (DataModuleInterface aDMI)     {
        DMI=aDMI;
        makeTree();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">


    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        DictionaryPanel = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        jPanel2 = new javax.swing.JPanel();
        jScrollPane4 = new javax.swing.JScrollPane();


        //setBorder(javax.swing.BorderFactory.createTitledBorder("Детализация данных"));
        setLayout(new java.awt.GridBagLayout());

        DictionaryPanel.setPreferredSize(new java.awt.Dimension(0, 0));
        DictionaryPanel.setLayout(new java.awt.GridBagLayout());

        jPanel1.setPreferredSize(new java.awt.Dimension(200, 200));
        jPanel1.setLayout(new javax.swing.BoxLayout(jPanel1, javax.swing.BoxLayout.LINE_AXIS));

        jPanel2.setLayout(new javax.swing.BoxLayout(jPanel2, javax.swing.BoxLayout.LINE_AXIS));

        jTree1.setEditable(true);
        jScrollPane4.setViewportView(jTree1);

        jPanel2.add(jScrollPane4);

        jPanel1.add(jPanel2);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        DictionaryPanel.add(jPanel1, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        add(DictionaryPanel, gridBagConstraints);
    }// </editor-fold>


    public JTree getTree (){
        return jTree1;
    }



    private void makeAnswerBranches(DefaultMutableTreeNode top) {
        try {
            top.add(new DefaultMutableTreeNode(new DMIProperty(2,DMI.getAnnotation(),DMI)));
            top.add(new DefaultMutableTreeNode(new DMIProperty(3,DMI.getStartDate(),DMI)));
            top.add(new DefaultMutableTreeNode(new DMIProperty(4,DMI.getEndDate(),DMI)));
            /*Integer I=DMI.getQuota();
            if (I!=null) top.add(new DefaultMutableTreeNode(new DMIProperty(5,DMI.getQuota().toString(),DMI)));
            else top.add(new DefaultMutableTreeNode(new DMIProperty(5,"0",DMI)));*/
        } catch(Exception re ) {
            System.out.println("Фигня какая то в словарях и их ответах "+re.toString());
        }
    }

    private void makeTree() {
        try {
            jTree1.removeAll();
            DefaultMutableTreeNode top = new DefaultMutableTreeNode(new DMIProperty(1,"Свойства вопроса",DMI));
            makeAnswerBranches(top);
            DefaultTreeModel TreeMоdel=new DefaultTreeModel(top);

            jTree1.getSelectionModel().setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);
            jTree1.setModel(TreeMоdel);
            jTree1.setDragEnabled(true);
            DMITreeCellRenderer  CQR=new DMITreeCellRenderer  ();
            DMITreeCellEditor    CQE=new DMITreeCellEditor    (jTree1);
            jTree1.setEditable(true);
            jTree1.setCellRenderer  (CQR);
            jTree1.setCellEditor    (CQE);

            
        } catch(Exception re ) {
            System.out.println("Фигня какая ETP "+re.toString());
        }
    }


    public class DMIProperty  {
        private String      Value;
        private int         PropertyIndex ;
        private DataModuleInterface    DMI ;

    public DMIProperty (int PropertyIndex, String Value, DataModuleInterface aDMI) {
        this.Value=Value;
        this.PropertyIndex=PropertyIndex;
        this.DMI=aDMI;
    }

    public String getValue() {
        return Value;
    }

    public void setValue(String Value) {
        try {
            this.Value=Value;
            switch (this.getProperyIndex()) {
                case 2:{
                    DMI.setAnnotation(Value,Lib.getID(),true);
                    break;
                }
                case 3:{
                    DMI.setStartDate(Value,Lib.getID(),true);
                    break;
                }
                case 4:{
                    DMI.setEndDate(Value,Lib.getID(),true);
                    break;
                }
                case 5:{
                    DMI.setQuota(new Integer(Value),Lib.getID(),true);
                    break;
                }
              }
        } catch (Exception E) {
            System.out.println("Ошибка в определении свойств DataModuleProperty "+E);
        }
    }

    public String toString() {
        String Header="";
        switch (this.getProperyIndex()) {
                case 1:{
                    Header="Свойства опроса ";
                    break;
                }
                case 2:{
                    Header="Аннотация ";
                    break;
                }
                case 3:{
                    Header="Дата началао опроса ";
                    break;
                }
                case 4:{
                    Header="Дата завершения опроса ";
                    break;
                }
                case 5:{
                    Header="Выборка ";
                    break;
                }
              }
        return Header+Value;
    }

    public int getProperyIndex() {
        return PropertyIndex;
    }

}

    public class DMITreeCellRenderer extends DefaultTreeCellRenderer {
        ImageIcon Icon1 = new ImageIcon("images/gif/18x16/08.gif");
        ImageIcon Icon2 = new ImageIcon("images/gif/18x16/01.gif");
        ImageIcon Icon3 = new ImageIcon("images/gif/18x16/10.gif");
        ImageIcon Icon4 = new ImageIcon("images/gif/18x16/09.gif");

        private DefaultTreeCellRenderer nonLeafRenderer = new DefaultTreeCellRenderer();

    public DMITreeCellRenderer() {    }

    public java.awt.Component getTreeCellRendererComponent(JTree tree, Object value,
						  boolean sel,
						  boolean expanded,
						  boolean leaf, int row,
						  boolean hasFocus) {
        java.awt.Component returnValue;
        ImageIcon icon=null;
        try {
            DMIProperty DMIP=(DMIProperty)((DefaultMutableTreeNode)value).getUserObject();
            switch (DMIP.getProperyIndex()) {
                case 1:{
                    icon=Icon1;
                    break;
                }
                case 2:{
                    icon=Icon2;
                    break;
                }
                case 3:{
                    icon=Icon3;
                    break;
                }
              }
        } catch (Exception E) {
            System.out.println("Ошибка в назначении иконки"+E);
        }
        if (icon!=null) {
            nonLeafRenderer.setOpenIcon(icon);
            nonLeafRenderer.setClosedIcon(icon);
            nonLeafRenderer.setLeafIcon(icon);
        }
        returnValue = nonLeafRenderer.getTreeCellRendererComponent(tree,value, sel, expanded, leaf, row, hasFocus);
        return returnValue;
    }
    }

    public class DMITreeCellEditor extends DefaultTreeCellEditor {
        ImageIcon Icon1 = new ImageIcon("images/gif/18x16/08.gif");
        ImageIcon Icon2 = new ImageIcon("images/gif/18x16/01.gif");
        ImageIcon Icon3 = new ImageIcon("images/gif/18x16/10.gif");
        ImageIcon Icon4 = new ImageIcon("images/gif/18x16/09.gif");

        public DMITreeCellEditor(JTree tree) {
        this(tree, (DefaultTreeCellRenderer)tree.getCellRenderer(), null);
    }

    public DMITreeCellEditor(JTree tree,  DQATreeCellRenderer renderer) {
        this(tree, renderer, null);
    }

    public DMITreeCellEditor(JTree tree, DefaultTreeCellRenderer renderer,TreeCellEditor editor) {
        super(tree,renderer,editor);
    }

   public Component getTreeCellEditorComponent(JTree tree, Object value1,
						boolean isSelected,
						boolean expanded,
						boolean leaf, int row) {
        setTree(tree);
        lastRow = row;
        DefaultMutableTreeNode node = (DefaultMutableTreeNode) value1;
        DMIProperty DMIP = (DMIProperty) node.getUserObject();
        try {
            Object value = (Object)DMIP.getValue();
            determineOffset(tree, value, isSelected, expanded, leaf, row);
            if (editingComponent != null) {
                editingContainer.remove(editingComponent);
            }
            editingComponent = realEditor.getTreeCellEditorComponent(tree, value, isSelected, expanded, leaf, row);
        } catch (Exception ex) {
        }
        TreePath        newPath = tree.getPathForRow(row);
        canEdit = (lastPath != null && newPath != null &&
		lastPath.equals(newPath));
        Font            font = getFont();

        if(font == null) {
            if(renderer != null)
            font = renderer.getFont();
            if(font == null) font = tree.getFont();
        }
        editingContainer.setFont(font);
        prepareForEditing();
        return editingContainer;
    }

    public Object getCellEditorValue() {
	//return realEditor.getCellEditorValue();
        DMIProperty DMIP=null;
        try {
            DefaultMutableTreeNode node = (DefaultMutableTreeNode) tree.getLastSelectedPathComponent();
            DMIP = (DMIProperty)node.getUserObject();
            DMIP.setValue(realEditor.getCellEditorValue().toString());
        } catch (Exception ex) {
        }
        return DMIP;
    }
   protected void determineOffset(JTree tree, Object value, boolean isSelected, boolean expanded, boolean leaf, int row) {

        if(renderer != null) {
            try {
             DMIProperty DMIP=(DMIProperty)((DefaultMutableTreeNode) tree.getLastSelectedPathComponent()).getUserObject();
             switch (DMIP.getProperyIndex()) {
                case 1:{
                    editingIcon=Icon1;
                    break;
                } case 2:{
                    editingIcon=Icon2;
                    break;
                } case 3:{
                    editingIcon=Icon3;
                    break;
                } case 4:{//datafilter
                    editingIcon=Icon4;
                    break;
                }
             }
            } catch (Exception E) {
                System.out.println("Ошибка в назначении иконки 2"+E);
            }
            if(editingIcon != null)
                offset = renderer.getIconTextGap() +
		        editingIcon.getIconWidth();
            else
                offset = renderer.getIconTextGap();
        }	else {
                editingIcon = null;
                offset = 0;
        }
    }
   }


    
    // Variables declaration - do not modify
    private javax.swing.JPanel DictionaryPanel;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane4;
    // End of variables declaration




}
