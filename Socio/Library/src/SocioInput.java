/*
 * Socioinput.java
 *
 * Created on 11 Декабрь 2003 г., 20:01
 */
import java.rmi.Naming;
import java.rmi.NotBoundException;
import java.rmi.AccessException;
import java.rmi.RemoteException;
import java.io.InputStreamReader;
import java.io.BufferedReader;

import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
import javax.swing.event.*;
import java.util.ArrayList;
import javax.swing.JPopupMenu;


/**
 *
 * @author  Иван
 */
public class SocioInput extends javax.swing.JFrame implements SocioInputInterface, DNDCompInterface {
    
    /** Creates new form Socioinput */
    //Main Server registration class
    private SocioInput Self;
    private JFrame XX;
    //private SocioInput frame;
    //private INIACRMIInterface iNIACRMIInterface;
    private INIACRMIInterface Server;
    //Server local session class
    private DictionaryInterface Dictionary;
    //private DictionaryManager Dict;
    private Integer DictionaryIndex;
    //Client refresher
    private SocioRefreshInterface Refresher;
    //Somebody else
    private DefaultListModel listQuestion;
    private DefaultListModel listAnswer;
    private ArrayList QuestArray;
    private QuestionInterface AnswerArray;
    private QuestionInterface Question;
    private int QuestIndex;
    private int AnswerIndex; 
    private DefaultListModel listDictionary;
    
   
   
    public SocioInput(INIACRMIInterface aServer) {
        Server = aServer;
        //Dictionary = aDictionary;
        
        
	try
	{
            Refresher=new SocioRefreshClient();
            Refresher.Register(this);
            initComponents();
            tuneComponent();
            
	}
	catch( Exception e )
	{
	    System.out.println( e.toString() );
	    System.exit(1);
	}
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        buttonGroup1 = new javax.swing.ButtonGroup();
        InputPanel = new javax.swing.JPanel();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel2 = new javax.swing.JPanel();
        jPanel11 = new javax.swing.JPanel();
        jToolBar1 = new javax.swing.JToolBar();
        New = new javax.swing.JButton();
        jButton7 = new javax.swing.JButton();
        jButton8 = new javax.swing.JButton();
        jButton4 = new javax.swing.JButton();
        jSplitPane2 = new javax.swing.JSplitPane();
        jPanel9 = new javax.swing.JPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        DictionaryList = new javax.swing.JList();
        jPanel10 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jList8 = new QuestListExp();
        jMenuBar1 = new javax.swing.JMenuBar();
        jMenu1 = new javax.swing.JMenu();
        jMenuItem1 = new javax.swing.JMenuItem();
        jMenu2 = new javax.swing.JMenu();
        jMenuItem2 = new javax.swing.JMenuItem();
        jMenu3 = new javax.swing.JMenu();
        jMenuItem3 = new javax.swing.JMenuItem();

        getContentPane().setLayout(new java.awt.GridBagLayout());

        setTitle("\u0412\u0432\u043e\u0434 \u0434\u0430\u043d\u043d\u044b\u0445");
        setResizable(false);
        InputPanel.setLayout(new java.awt.BorderLayout());

        InputPanel.setPreferredSize(new java.awt.Dimension(550, 300));
        jPanel2.setLayout(new java.awt.GridBagLayout());

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder("\u0421\u043b\u043e\u0432\u0430\u0440\u044c"));
        jPanel11.setBorder(javax.swing.BorderFactory.createTitledBorder("\u0412\u044b\u0431\u043e\u0440\u043a\u0430"));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        jPanel2.add(jPanel11, gridBagConstraints);

        New.setText("New");
        New.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                NewActionPerformed(evt);
            }
        });

        jToolBar1.add(New);

        jButton7.setText("Del");
        jButton7.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton7ActionPerformed(evt);
            }
        });

        jToolBar1.add(jButton7);

        jButton8.setText("Rename");
        jButton8.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton8ActionPerformed(evt);
            }
        });

        jToolBar1.add(jButton8);

        jButton4.setText("DelQuest");
        jButton4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton4ActionPerformed(evt);
            }
        });

        jToolBar1.add(jButton4);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        jPanel2.add(jToolBar1, gridBagConstraints);

        jPanel9.setLayout(new java.awt.GridBagLayout());

        jPanel9.setBorder(javax.swing.BorderFactory.createTitledBorder("\u0421\u043b\u043e\u0432\u0430\u0440\u044c"));
        DictionaryList.setMinimumSize(new java.awt.Dimension(100, 0));
        DictionaryList.addListSelectionListener(new javax.swing.event.ListSelectionListener() {
            public void valueChanged(javax.swing.event.ListSelectionEvent evt) {
                ChangeDictionaryList(evt);
            }
        });

        jScrollPane2.setViewportView(DictionaryList);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel9.add(jScrollPane2, gridBagConstraints);

        jSplitPane2.setLeftComponent(jPanel9);

        jPanel10.setLayout(new java.awt.GridBagLayout());

        jPanel10.setBorder(javax.swing.BorderFactory.createTitledBorder("\u0412\u043e\u043f\u0440\u043e\u0441\u044b"));
        jList8.setMinimumSize(new java.awt.Dimension(100, 0));
        jScrollPane1.setViewportView(jList8);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel10.add(jScrollPane1, gridBagConstraints);

        jSplitPane2.setRightComponent(jPanel10);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel2.add(jSplitPane2, gridBagConstraints);

        jTabbedPane1.addTab("\u0421\u043b\u043e\u0432\u0430\u0440\u0438", jPanel2);

        InputPanel.add(jTabbedPane1, java.awt.BorderLayout.CENTER);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(InputPanel, gridBagConstraints);

        jMenu1.setText("\u041f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f");
        jMenuItem1.setText("Connect");
        jMenuItem1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem1ActionPerformed(evt);
            }
        });

        jMenu1.add(jMenuItem1);

        jMenuBar1.add(jMenu1);

        jMenu2.setText("\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u044f");
        jMenu2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenu2ActionPerformed(evt);
            }
        });

        jMenuItem2.setText("Item");
        jMenuItem2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem2ActionPerformed(evt);
            }
        });

        jMenu2.add(jMenuItem2);

        jMenuBar1.add(jMenu2);

        jMenu3.setText("\u0421\u043b\u043e\u0432\u0430\u0440\u044c");
        jMenuItem3.setText("\u041f\u0435\u0440\u0435\u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043b\u043e\u0432\u0430\u0440\u044c");
        jMenu3.add(jMenuItem3);

        jMenuBar1.add(jMenu3);

        setJMenuBar(jMenuBar1);

        pack();
    }// </editor-fold>//GEN-END:initComponents
    
    private void jButton8ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton8ActionPerformed
// TODO add your handling code here:
        //..Переименовываем словарь
        try {
            //iNIACRMIInterface.NewQuest();
            //iNIACRMIInterface.Register();
            CustomDialog customDialog = new CustomDialog(this,Server.getDictionary(DictionaryIndex).getName(),"Название словаря");
            customDialog.pack();
            customDialog.setLocationRelativeTo(this);
            customDialog.setVisible(true);
            String s = customDialog.getValidatedText();
            System.out.println("Что то там ввели новое" );	
            if (s != null) {
                try {
                    Server.getDictionary(DictionaryIndex).setName(s,0,true);
                    RefreshDictionaryList();
                } catch( RemoteException re ) {
                    System.out.println(re.toString());	   
                }
            }
        } catch(Exception re ) {
            System.out.println(re.toString());	   
        }        
    }//GEN-LAST:event_jButton8ActionPerformed

    private void jButton7ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton7ActionPerformed
        //TODO add your handling code here:
        //Удаляем этот словарь 
        try {
            DeleteDictionary();
        } catch( Exception re ) {
            System.out.println(re.toString());	   
        }   
    }//GEN-LAST:event_jButton7ActionPerformed

    private void DeleteDictionary() throws RemoteException {
        //Server.ReleaseDictionary(DictionaryIndex);
        //ReleaseDictionary(DictionaryIndex);
    }
    
    private void RenameDictionary() throws RemoteException {                                           
            DictionaryInterface DI = Server.getDictionary(DictionaryIndex);
            CustomDialog customDialog = new CustomDialog(this,DI.getName(),"Название словаря");
            customDialog.pack();
            customDialog.setLocationRelativeTo(this);
            customDialog.setVisible(true);
            String s = customDialog.getValidatedText();
            if (s != null) {
                try {
                    DI.setName(s,0,true);
                    RefreshDictionaryList();
                } catch( RemoteException re ) {
                    System.out.println(re.toString());	   
                }
            }        
    }
    
    private void jMenuItem2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem2ActionPerformed
        // TODO add your handling code here:
        System.out.println("Печатаю какую то хрень ");	
        QuestionEditorForm();
    }//GEN-LAST:event_jMenuItem2ActionPerformed

    private void jMenu2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenu2ActionPerformed
        // TODO add your handling code here:
        // Открытие нового окна              
    }//GEN-LAST:event_jMenu2ActionPerformed

    private void QuestionEditorForm() {
        try {
            QuestionEditorFrame questionEditorFrame = new QuestionEditorFrame(Server);
            questionEditorFrame.setTitle("Редактирование словарей");
            questionEditorFrame.setDictionary(Server.getMainDictionary());
            questionEditorFrame.setVisible(true);
        } catch( Exception re ) {
            System.out.println(re.toString());	   
        }     
    }
    
    private void ChangeDictionaryList(javax.swing.event.ListSelectionEvent evt) {//GEN-FIRST:event_ChangeDictionaryList
        DictionaryInfo DI=(DictionaryInfo)DictionaryList.getSelectedValue();
        DictionaryIndex = DI.getID();
        try {
            QuestListExp QLE= (QuestListExp)jList8;
            QLE.setDictionary(Server.getDictionary(DictionaryIndex));
            RefreshQuestionList();
        } catch( Exception re ) {
            System.out.println(re.toString());	   
        }     
    }//GEN-LAST:event_ChangeDictionaryList

    private void jButton4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton4ActionPerformed
        // TODO add your handling code here:
        // Добавление вопроса в словарь
        try {
            //System.out.println(DictionaryIndex+"-"+Server.GetDictionarySize());
            //System.out.println(re.toString());	   
            //Server.GetDictionary(DictionaryIndex).ReleaseQuest(jList8.getSelectedIndex());
            RefreshQuestionList();
        } catch( Exception re ) {
            System.out.println(re.toString());	   
        }   
        
    
    }//GEN-LAST:event_jButton4ActionPerformed

    private void NewDictionary() {
        System.out.println( "Кто то кнопку 6 нажал" );	
        try {
            //iNIACRMIInterface.NewQuest();
            //iNIACRMIInterface.Register();
            CustomDialog customDialog = new CustomDialog(this,"","Название словаря");
            customDialog.pack();
            customDialog.setLocationRelativeTo(this);
            customDialog.setVisible(true);
            String s = customDialog.getValidatedText();
            System.out.println("Что то там ввели новое" );	
            if (s != null) {
                try {
                    System.out.println(s);	   
                    Integer IDKey = Server.getKey();
                    Server.newDictionary(s,IDKey, true);
                    System.out.println("Inserting Dictionary");	   
                } catch( RemoteException re ) {
                    System.out.println(re.toString());	   
                }
            }
        } catch(Exception re ) {
            System.out.println(re.toString());	   
        }        
    }
    private void NewActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_NewActionPerformed
        // TODO add your handling code here:
        // Add your handling code here:
        NewDictionary();
    }//GEN-LAST:event_NewActionPerformed

    private void jMenuItem1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem1ActionPerformed
        // Add your handling code here:
        Library Catalog=new Library();
        Catalog.setVisible(true);
        System.out.println( "Lets Connect" );
    }//GEN-LAST:event_jMenuItem1ActionPerformed
    /*public void Functionality2() throws RemoteException {
        System.out.println("Функциональность ответов");
        try {
            //QuestArray.get(index
            AnswerInterface Answer;
            System.out.println("Размер пула ответов"+AnswerArray.GetAnswerSize());	   
            int AnswerIndex=0;    
            listAnswer.clear();
            while (AnswerIndex<AnswerArray.GetAnswerSize() ) {
                System.out.println(AnswerIndex);    
                Answer = AnswerArray.getAnswer(AnswerIndex);
                listAnswer.addElement(Answer.getName());
                AnswerIndex++;
            };
            //if (listQuestion.size()>0) then 
            System.out.println( "Выведен список ответов" );	   
        } catch( Exception re ) {
            System.out.println(re.toString());	   
        }
    }*/

    private void jList1FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jList1FocusGained
        // Add your handling code here:
    }//GEN-LAST:event_jList1FocusGained
/*public void RefreshDictionary() throws RemoteException {
        
        
        System.out.println("Функциональность djghjctfz");
        try {
            QuestionInterface Quest;
            System.out.println("Функциональность 1");
            DictionaryInterface dd = Server.GetMainDictionary();
            //QuestArray = Server.GetMainDictionary().GetQuestArray();
            //System.out.println(Server.GetMainDictionary().GetQuestSize());	   
            int i=0;    
            listQuestion.clear();
            while (i<Server.GetMainDictionary().GetQuestSize()) {
                System.out.println(i+   Server.GetMainDictionary().GetQuestion(i).GetName());
                listQuestion.addElement(Server.GetMainDictionary().GetQuestion(i).GetName());
                i++;
            };
            //if (listQuestion.size()>0) then 
        
            System.out.println( "Фун" );	   
        } catch( Exception re ) {
            System.out.println(re.toString());	   
        }
    }*/

    private void tuneComponent()  throws RemoteException {
       
        try {
            //ListDictionary();
            listDictionary = new DefaultListModel();
            //DictionaryList = new DNDList();
            DictionaryList.setModel(listDictionary);
            RefreshDictionaryList();
            listQuestion = new DefaultListModel();
            //jList8 = new DNDList();
            jList8.setModel(listQuestion);
            jList8.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);
            jList8.setDragEnabled(true);
            jList8.setTransferHandler(new SocioInputListHandler());
            createPopupMenu();
            createPopupMenu2();
            //RefreshDictionary();
            QuestListExp QLE= (QuestListExp)jList8;
            QLE.setMainDictionary(Server.getMainDictionary());
        } catch(Exception re ) {
        }
        //JScrollPane listScrollPane = new JScrollPane(jList1);
        //jList1.addListSelectionListener(this);
     }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JList DictionaryList;
    private javax.swing.JPanel InputPanel;
    private javax.swing.JButton New;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JButton jButton4;
    private javax.swing.JButton jButton7;
    private javax.swing.JButton jButton8;
    private javax.swing.JList jList8;
    private javax.swing.JMenu jMenu1;
    private javax.swing.JMenu jMenu2;
    private javax.swing.JMenu jMenu3;
    private javax.swing.JMenuBar jMenuBar1;
    private javax.swing.JMenuItem jMenuItem1;
    private javax.swing.JMenuItem jMenuItem2;
    private javax.swing.JMenuItem jMenuItem3;
    private javax.swing.JPanel jPanel10;
    private javax.swing.JPanel jPanel11;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JSplitPane jSplitPane2;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JToolBar jToolBar1;
    // End of variables declaration//GEN-END:variables
    
    public static void main(String[] args) {
        SocioInput frame = new SocioInput(null);
        //Self=frame;
        frame.setTitle("Такая вот невидаль");
        frame.setVisible(true);
    }
    
    public void Register () {
 	System.out.println( "Зарегистрировался" );	   
    }
    
    public void QuestRefresh() throws RemoteException { }
    
    public void RefreshAnswerList() throws RemoteException {};
    
    public void RefreshQuestionList() throws RemoteException {
        System.out.println( "Обновление списка вопросов 1" );	   
        try {
            if (DictionaryIndex.intValue()!=-1) {
                listQuestion.clear();
                DictionaryInterface DI=Server.getDictionary(DictionaryIndex);
                ArrayList Keys = DI.getKeys();
                int i=0;
                while (i<Keys.size()) {
                    RInterface RQM=DI.getByPos(new Integer(i));
                    System.out.println("Печатаю вопросы "+RQM.getID()+" "+RQM.getPos());	   
                    QuestListContent QLC=new QuestListContent(RQM,Server.getMainDictionary().getQuestion(RQM.getID()));
                    listQuestion.addElement(QLC);
                    i++;
                };
                System.out.println( "Функционально работает" );	   
            } 
        } catch( Exception re ) {
            System.out.println("Ошибка оформления списка "+re.toString());	   
        }
    }
    
 private class DictionaryInfo {
        public DictionaryInterface DI;
        public DictionaryInfo(DictionaryInterface aDI) {
            DI = aDI;
        }
        public String toString() {
            String Name = "";
            try {
                Name=DI.getName();
            } catch( Exception re ) {
                System.out.println(re.toString());	   
            }
            return Name;
        }
        
        public Integer getID() {
            Integer ID = null;
            try {
                ID=DI.getID();
            } catch( Exception re ) {
                System.out.println(re.toString());	   
            }
            return ID;
        }
    }  
    
    public void RefreshDictionaryList() throws RemoteException {
       try {
            int i=0;    
            DictionaryIndex=null;
            listDictionary.removeAllElements();
            ArrayList Keys=Server.getDictionaryKeys();
            while (i<Keys.size()) {
                listDictionary.addElement(new DictionaryInfo(Server.getDictionary((Integer)Keys.get(i))));
                i++;
            };
        } catch( Exception re ) {
            System.out.println(re.toString());	   
        } 
    }
    
      
    public void AnswerRefresh() throws RemoteException {
    }
    
    public void addElement(QuestionInterface QI)  throws RemoteException {
        Server.getDictionary(DictionaryIndex).addElement(QI.getID(),0,true);
        RefreshQuestionList();
        
    };
    
    public void removeElement(int i) {
        
    };
    
    public void RecodeDictionary() {
        //Пытаемся перекодировать словарь .. 
        try {
            //DictionaryInterface DI=Server.GetDictionary(DictionaryIndex);
            //DI.ClearQuest();
            int i=0;
            while (i<listQuestion.size()) {
                    QuestListContent QLM = (QuestListContent) listQuestion.get(i);
                    RInterface RQI=QLM.getRInterface();
                    //System.out.println("До изменения "+RQI.getID()+" "+RQI.getPos());	   
                    RQI.setPos(new Integer(i));
                    //System.out.println("После изменения"+RQI.getID()+" "+RQI.getPos());	   
                    i++;
            };
        } catch( Exception re ) {
            System.out.println(re.toString());	   
        }    
    };
    
    
    
    public void DeleteFromDictionary() {
        try {
            QuestListContent QM;
            DictionaryInterface DI=Server.getDictionary(DictionaryIndex);
            Object[] values = jList8.getSelectedValues();
            for (int i = 0; i < values.length; i++) {
                Object O=values[i];
                QM = (QuestListContent)O;
                DI.delByPos(QM.getPos(),0,true);
                //RecodeDictionary();
            }
            RefreshQuestionList();
        } catch( Exception re ) {
            System.out.println(re.toString());	   
        }    
    };
    
    
    
    public void createPopupMenu() {
        JMenuItem menuItem;
        //Create the popup menu.
        JPopupMenu popup = new JPopupMenu();
        menuItem = new JMenuItem("Перекодировать");
        menuItem.addActionListener(new ActionListener() {
             public void actionPerformed(ActionEvent e)  {
                 RecodeDictionary();
                 System.out.println("Перекодируем");	                 
             }
        });  
        popup.add(menuItem);
        menuItem = new JMenuItem("Удалить вопрос");
         menuItem.addActionListener(new ActionListener() {
             public void actionPerformed(ActionEvent e)  {
                 DeleteFromDictionary();
                 System.out.println("Удаляем вопрос");	                 
             }
        });  
        popup.add(menuItem);
        //Add listener to the text area so the popup menu can come up.
        MouseListener popupListener = new PopupListener(popup);
        jList8.addMouseListener(popupListener);
    }
    
    class PopupListener extends MouseAdapter {
        JPopupMenu popup;

        PopupListener(JPopupMenu popupMenu) {
            popup = popupMenu;
        }

        public void mousePressed(MouseEvent e) {
            maybeShowPopup(e);
        }

        public void mouseReleased(MouseEvent e) {
            maybeShowPopup(e);
        }

        private void maybeShowPopup(MouseEvent e) {
            if (e.isPopupTrigger()) {
                popup.show(e.getComponent(),
                           e.getX(), e.getY());
            }
        }
    }

    public void createPopupMenu2() {
        JMenuItem menuItem;
        //Create the popup menu.
        JPopupMenu popup = new JPopupMenu();
        menuItem = new JMenuItem("Добавить");
        menuItem.addActionListener(new ActionListener() {
             public void actionPerformed(ActionEvent e)  {
                 NewDictionary();
                 System.out.println("Добавить");	                 
             }
        });  
        popup.add(menuItem);
        menuItem = new JMenuItem("Переименовать");
        menuItem.addActionListener(new ActionListener() {
             public void actionPerformed(ActionEvent e)  {
                 try {
                    RenameDictionary();
                    System.out.println("Переименовать");	                 
                 } catch( Exception re ) {
                    System.out.println(re.toString());	   
                 }                  
             }
        });  
        popup.add(menuItem);
        menuItem = new JMenuItem("Удалить");
        menuItem.addActionListener(new ActionListener() {
             public void actionPerformed(ActionEvent e)  {
                 try {
                    DeleteDictionary();
                    System.out.println("Удалить");	                 
                 } catch( Exception re ) {
                    System.out.println(re.toString());	   
                 }   
             }
        });  
        popup.add(menuItem);
        //Add listener to the text area so the popup menu can come up.
        MouseListener popupListener = new PopupListener2(popup);
        DictionaryList.addMouseListener(popupListener);
    }
    
    class PopupListener2 extends MouseAdapter {
        JPopupMenu popup;

        PopupListener2(JPopupMenu popupMenu) {
            popup = popupMenu;
        }

        public void mousePressed(MouseEvent e) {
            maybeShowPopup(e);
        }

        public void mouseReleased(MouseEvent e) {
            maybeShowPopup(e);
        }

        private void maybeShowPopup(MouseEvent e) {
            if (e.isPopupTrigger()) {
                popup.show(e.getComponent(),
                           e.getX(), e.getY());
            }
        }
    }
    
;
}
